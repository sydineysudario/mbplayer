<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Musical Maria Bonita</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap");

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", sans-serif;
            min-height: 100vh;
            background-image: url(https://github.com/ecemgo/mini-samples-great-tricks/assets/13468728/aa462558-0106-4268-9864-d34a4f35531f);
            background-repeat: no-repeat;
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Glassmorphism Container */
        .main-container {
            width: 95%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(255, 255, 255, 0.1);
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 700px;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .user-profile {
            text-align: center;
            margin-bottom: 40px;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin: 0 auto 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-status {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: translateX(5px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            height: 100%;
        }

        /* Left Content */
        .content-area {
            padding: 30px;
            overflow-y: auto;

        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #fff, #e1bee7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Popular Playlists Slider */
        .playlists-slider {
            margin-bottom: 50px;
        }

        .swiper {
            width: 100%;
            padding: 20px 0 40px;
        }

        .swiper-slide {
            width: 300px;
            height: 200px;
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
        }

        .slide-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .swiper-slide:hover .slide-image {
            transform: scale(1.05);
        }

        .slide-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, rgba(0, 0, 0, 0.7), transparent);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
        }

        .slide-title {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .play-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            width: fit-content;
        }

        .play-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Artists Grid */
        .artists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        .artist-card {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .artist-card:hover {
            transform: translateY(-5px);
        }

        .artist-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            margin: 0 auto 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .artist-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .artist-name {
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Albums Grid */
        .albums-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .album-card {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .album-card:hover {
            transform: translateY(-5px);
        }

        .album-cover {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            /* Added for cover change button */
        }

        .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .album-card:hover .album-cover img {
            transform: scale(1.05);
        }

        .album-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .album-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        /* Right Sidebar - Player */
        .player-sidebar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
        }

        /* Search */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-input:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
        }

        /* Songs List */
        .songs-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .songs-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .song-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .song-item.playing {
            background: rgba(255, 255, 255, 0.15);
        }

        .song-cover {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 12px;
            position: relative;
        }

        .song-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .song-cover-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }

        .song-item:hover .song-cover-overlay {
            opacity: 1;
        }

        .song-cover-change {
            position: absolute;
            top: -5px;
            right: -5px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.7rem;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .song-item:hover .song-cover-change {
            opacity: 1;
        }

        .song-cover-change:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .song-cover-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .song-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
        }

        .song-duration {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }

        /* Music Player */
        .music-player {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }

        .current-song-cover {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .current-song-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .current-song-cover.rotating img {
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .vinyl-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            z-index: 2;
        }

        .current-song-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .current-song-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 25px;
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .progress-bar::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Controls */
        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        /* Floating Controls at Bottom - Expandido */
        .floating-controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            background: rgba(186, 164, 235, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 15px 25px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(186, 164, 235, 0.3);
            width: 90%;
            max-width: 600px;
            min-width: 500px;
            /* Adicionado para o efeito de esmaecimento */
            opacity: 1;
            /* Visível por padrão */
            transition: opacity 0.5s ease-in-out;
            /* Transição suave de 0.5 segundos */
            pointer-events: auto;
            /* Permite interação por padrão */
        }

        /* Classe para esconder o player flutuante */
        .floating-controls.hidden {
            opacity: 0;
            /* Torna o elemento completamente transparente */
            pointer-events: none;
            /* Desabilita a interação quando escondido */
        }

        /* Capa da música nos controles flutuantes */
        .floating-song-cover {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
        }

        .floating-song-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Informações da música nos controles flutuantes */
        .floating-song-info {
            flex: 1;
            text-align: left;
            margin-left: 15px;
            margin-right: 15px;
        }

        .floating-song-title {
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .floating-song-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Barra de progresso nos controles flutuantes */
        .floating-progress-container {
            width: 100%;
            margin-top: 8px;
        }

        .floating-progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .floating-progress-bar::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .floating-progress-bar::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* Controles de botões flutuantes */
        .floating-controls-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        .control-btn.play-pause {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
        }

        .control-btn.play-pause:hover {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.25);
        }

        /* Ads Section */
        .ads-section {
            color: white;
        }

        .ads-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: white;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-select,
        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-select:focus,
        .form-input:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .form-select option {
            background: rgba(16, 21, 61, 0.9);
            color: white;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Playlists Section */
        .playlists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .playlist-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .playlist-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .playlist-cover {
            width: 100%;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.5);
            overflow: hidden;
        }

        .playlist-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .playlist-title {
            color: white;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .playlist-count {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Add Music Section */
        .add-music-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .add-music-title {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .music-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .music-form .form-group {
            margin-bottom: 0;
        }

        .music-form .form-group.full-width {
            grid-column: 1 / -1;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
            text-align: left;
        }

        .file-input-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .file-input-hidden {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        /* Ad Countdown Overlay on Progress Bar */
        .progress-countdown-overlay {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 69, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1000;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Ad Notification */
        .ad-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(16, 21, 61, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: white;
            z-index: 10000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 350px;
        }

        .ad-notification h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .countdown {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .ad-playing-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(16, 21, 61, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 165, 0, 0.6);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            color: white;
            z-index: 10000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            min-width: 300px;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        .ad-playing-notification.fade-out {
            opacity: 0;
        }

        .ad-playing-notification h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #ffa500;
        }

        .ad-playing-notification .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 165, 0, 0.3);
            border-top: 4px solid #ffa500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 250px 1fr;
            }

            .main-content {
                grid-template-columns: 1fr 300px;
            }

            .floating-controls {
                min-width: 400px;
                max-width: 500px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }

            .sidebar {
                padding: 20px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .user-profile {
                display: flex;
                align-items: center;
                text-align: left;
                margin-bottom: 20px;
            }

            .user-avatar {
                width: 60px;
                height: 60px;
                margin: 0 15px 0 0;
            }

            .nav-menu {
                display: flex;
                gap: 10px;
                overflow-x: auto;
            }

            .nav-item {
                margin-bottom: 0;
                white-space: nowrap;
            }

            .floating-controls {
                width: 95%;
                min-width: 300px;
                max-width: 450px;
                padding: 12px 15px;
            }

            .floating-song-cover {
                width: 40px;
                height: 40px;
            }

            .floating-song-info {
                margin-left: 10px;
                margin-right: 10px;
            }

            .control-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }

            .control-btn.play-pause {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }

            .music-form {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* New styles for album cover change button */
        .album-cover-change {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .album-card:hover .album-cover-change {
            opacity: 1;
        }

        .album-cover-change:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Floating Maria Bonita Button */
        .maria-bonita-btn {
            position: fixed;
            bottom: 100px;
            /* Adjust to be above floating controls */
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 1001;
            /* Above floating controls */
            border: 3px solid rgba(255, 255, 255, 0.5);
        }

        .maria-bonita-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
        }

        .maria-bonita-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Maria Bonita Modal */
        .maria-bonita-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10002;
            /* Above everything */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .maria-bonita-modal-content {
            background: rgba(16, 21, 61, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            color: white;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .maria-bonita-modal-content h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fff, #e1bee7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .maria-bonita-modal-content textarea {
            width: calc(100% - 20px);
            height: 120px;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            outline: none;
        }

        .maria-bonita-modal-content textarea:focus {
            border-color: rgba(255, 255, 255, 0.6);
        }

        .char-counter {
            text-align: right;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
        }

        .maria-bonita-modal-content button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .maria-bonita-modal-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .maria-bonita-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(220, 53, 69, 0.6);
            border: none;
            border-radius: 50%;
            color: white;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background 0.3s ease;
        }

        .maria-bonita-modal-close:hover {
            background: rgba(220, 53, 69, 0.8);
        }

        .maria-bonita-status {
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .maria-bonita-status.error {
            color: #ff6b6b;
            font-weight: 600;
        }

        .maria-bonita-status.success {
            color: #6bff6b;
            font-weight: 600;
        }

        /* Maria Bonita Section */
        .maria-bonita-section {
            color: white;
        }

        .maria-bonita-section .info-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .maria-bonita-section .info-box h2 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .maria-bonita-section .info-box p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .maria-bonita-section .info-box strong {
            color: #e1bee7;
        }

        .maria-bonita-section .info-box .reset-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .maria-bonita-section .info-box .reset-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* New styles for scheduled ads */
        .scheduled-ads-list {
            margin-top: 30px;
        }

        .scheduled-ad-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scheduled-ad-item.playing-now {
            border: 2px solid #ffa500;
            box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }

        .scheduled-ad-info {
            flex-grow: 1;
        }

        .scheduled-ad-info strong {
            color: white;
            font-size: 1rem;
        }

        .scheduled-ad-info span {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .scheduled-ad-actions button {
            background: rgba(220, 53, 69, 0.6);
            border: none;
            border-radius: 5px;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .scheduled-ad-actions button:hover {
            background: rgba(220, 53, 69, 0.8);
        }

        /* Login Screen Styles */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url(https://github.com/ecemgo/mini-samples-great-tricks/assets/13468728/aa462558-0106-4268-9864-d34a4f35531f);
            background-size: cover;
            background-position: center;
            backdrop-filter: blur(10px); /* Blurred background */
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10003; /* Above all other elements */
            flex-direction: column;
            color: white;
            text-align: center;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(255, 255, 255, 0.1);
            padding: 40px;
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .login-gif-container {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .login-gif-container img,
        .login-gif-container canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .login-gif-container canvas {
            display: block; /* Show canvas by default */
        }

        .login-gif-container img {
            display: none; /* Hide img by default */
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #e1bee7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .login-input:focus {
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .login-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .login-status {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .welcome-message {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-top: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .welcome-message.show {
            opacity: 1;
        }

        .welcome-username {
            font-size: 1.8rem;
            font-weight: 600;
            color: #e1bee7;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .welcome-username.show {
            opacity: 1;
        }

    </style>
</head>

<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-gif-container">
                <canvas id="gifCanvas"></canvas>
                <img id="animatedGif" src="https://i.postimg.cc/dQ9zctfr/lv-0-20250910064455.gif" alt="Maria Bonita GIF">
            </div>
            <h1 class="login-title">Bem-Vindo(a)</h1>
            <p class="welcome-message" id="welcomeMessage"></p>
            <p class="welcome-username" id="welcomeUsername"></p>
            <input type="email" id="loginEmail" class="login-input" placeholder="E-mail">
            <input type="password" id="loginPassword" class="login-input" placeholder="Senha">
            <button id="loginButton" class="login-button">Entrar</button>
            <p id="loginStatus" class="login-status"></p>
        </div>
    </div>

    <!-- Main Content Container (initially hidden) -->
    <div class="main-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div>
                <div class="user-profile">
                    <div class="user-avatar">
                        <img src="https://i.postimg.cc/854CDB8M/Untitled-design-8.png" alt="User Avatar">
                    </div>
                    <div class="user-name">Maria Bonita</div>
                    <div class="user-status">Premium User</div>
                </div>

                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-section="discover">
                                <i class="fas fa-compass nav-icon"></i>
                                <span>Descobrir</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="playlists">
                                <i class="fas fa-list nav-icon"></i>
                                <span>Playlists</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="ads">
                                <i class="fas fa-bullhorn nav-icon"></i>
                                <span>Anúncios</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="maria-bonita">
                                <i class="fas fa-microphone-alt nav-icon"></i>
                                <span>Maria Bonita</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="fas fa-user nav-icon"></i>
                            <span>Perfil</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <i class="fas fa-cog nav-icon"></i>
                            <span>Configurações</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Content Area -->
            <div class="content-area">
                <!-- Discover Section -->
                <div class="content-section active" id="discover-section">
                    <h1 class="section-title">Descobrir Música</h1>

                    <!-- Popular Playlists -->
                    <div class="playlists-slider">
                        <h2 style="color: white; margin-bottom: 20px; font-size: 1.3rem;">Playlists Populares</h2>
                        <div class="swiper">
                            <div class="swiper-wrapper" id="popularPlaylistsContainer">
                                <!-- Playlists populares serão carregadas dinamicamente aqui -->
                                <p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">
                                    Nenhuma playlist popular ainda.</p>
                            </div>
                            <div class="swiper-pagination"></div>
                        </div>
                    </div>

                    <!-- Featured Artists -->
                    <div style="margin-bottom: 40px;">
                        <h2 style="color: white; margin-bottom: 20px; font-size: 1.3rem;">Artistas em Destaque</h2>
                        <div class="artists-grid" id="featuredArtistsContainer">
                            <!-- Artistas em destaque serão carregados dinamicamente aqui -->
                            <p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhum
                                artista em destaque ainda.</p>
                        </div>
                    </div>

                    <!-- Recommended Albums -->
                    <div>
                        <h2 style="color: white; margin-bottom: 20px; font-size: 1.3rem;">Álbuns Recomendados</h2>
                        <div class="albums-grid" id="recommendedAlbumsContainer">
                            <!-- Álbuns recomendados serão carregados dinamicamente aqui -->
                            <p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhum
                                álbum recomendado ainda.</p>
                        </div>
                    </div>
                </div>

                <!-- Ads Section -->
                <div class="content-section ads-section" id="ads-section">
                    <h1 class="section-title">Gerenciar Anúncios</h1>

                    <div class="ads-controls">
                        <div class="form-group">
                            <label class="form-label" for="adsInterval">Tocar anúncios a cada:</label>
                            <select class="form-select" id="adsInterval">
                                <option value="3">3 músicas</option>
                                <option value="5" selected>5 músicas</option>
                                <option value="10">10 músicas</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="adsUpload">Carregar anúncios (arquivos de áudio):</label>
                            <input type="file" class="form-input" id="adsUpload" multiple accept="audio/*">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="adOrder">Ordem dos anúncios:</label>
                            <select class="form-select" id="adOrder">
                                <option value="sequential">Sequencial</option>
                                <option value="random" selected>Aleatória</option>
                            </select>
                        </div>

                        <div
                            style="text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <p>Status: <span id="adStatus">Anúncios desativados</span></p>
                            <p>Próximo anúncio em: <span id="nextAdCounter">5 músicas</span></p>
                        </div>
                    </div>

                    <div
                        style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 25px;">
                        <h2 style="margin-bottom: 20px;">Anúncios Carregados</h2>
                        <div id="adsList">
                            <p style="text-align: center; opacity: 0.7;">Nenhum anúncio carregado ainda.</p>
                        </div>
                    </div>

                    <!-- Scheduled Ads Section -->
                    <div class="ads-controls scheduled-ads-section" style="margin-top: 30px;">
                        <h2 style="margin-bottom: 20px;">Programar Anúncio</h2>
                        <div class="form-group">
                            <label class="form-label" for="scheduledAdSelect">Selecionar Anúncio:</label>
                            <select class="form-select" id="scheduledAdSelect">
                                <option value="">Selecione um anúncio carregado</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="scheduledAdTime">Hora para tocar (HH:MM):</label>
                            <input type="time" class="form-input" id="scheduledAdTime" required>
                        </div>
                        <button class="btn" onclick="scheduleAd()" style="width: 100%;">Programar Anúncio</button>

                        <div class="scheduled-ads-list" style="margin-top: 30px;">
                            <h3 style="margin-bottom: 15px;">Anúncios Programados</h3>
                            <div id="scheduledAdsList">
                                <p style="text-align: center; opacity: 0.7;">Nenhum anúncio programado ainda.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Maria Bonita Section -->
                <div class="content-section maria-bonita-section" id="maria-bonita-section">
                    <h1 class="section-title">Anunciar com Maria Bonita</h1>

                    <div class="info-box">
                        <h2>Sobre a Maria Bonita AI</h2>
                        <p>Aqui você pode usar a voz da Maria Bonita para fazer anúncios personalizados! Basta digitar o
                            texto que deseja que ela fale.</p>
                        <p><strong>Atenção:</strong> Utilizamos a API do Eleven Labs. A versão gratuita possui um limite
                            de <strong>18.000 caracteres por mês</strong>.</p>
                        <p>Se você estiver ouvindo uma música, o volume dela será reduzido automaticamente enquanto a
                            Maria Bonita fala, e voltará ao normal depois.</p>
                    </div>

                    <div class="info-box">
                        <h2>Uso de Caracteres</h2>
                        <p>Caracteres usados este mês: <strong id="charsUsedDisplay">0</strong> / 18.000</p>
                        <p>Próxima redefinição: <strong id="nextResetDate">--/--/----</strong></p>
                        <button class="reset-button" onclick="resetCharacterCount()">Redefinir Contagem (Apenas para
                            Teste)</button>
                    </div>
                </div>

                <!-- Playlists Section -->
                <div class="content-section" id="playlists-section">
                    <h1 class="section-title">Minhas Playlists</h1>

                    <!-- Add Music Section -->
                    <div class="add-music-section">
                        <h2 class="add-music-title">
                            <i class="fas fa-plus-circle"></i>
                            Adicionar Nova Música
                        </h2>
                        <form class="music-form" id="addMusicForm">
                            <div class="form-group">
                                <label class="form-label" for="musicTitle">Título da Música</label>
                                <input type="text" class="form-input" id="musicTitle"
                                    placeholder="Digite o título da música" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="musicArtist">Artista</label>
                                <input type="text" class="form-input" id="musicArtist"
                                    placeholder="Digite o nome do artista" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Capa do Artista (opcional)</label>
                                <div class="file-input-wrapper">
                                    <label for="artistCover" class="file-input-btn">
                                        <i class="fas fa-user-circle"></i>
                                        <span id="artistCoverFileName">Selecionar capa do artista</span>
                                    </label>
                                    <input type="file" id="artistCover" class="file-input-hidden" accept="image/*">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="musicAlbumSelect">Álbum</label>
                                <select class="form-select" id="musicAlbumSelect" required
                                    onchange="toggleNewAlbumFields()">
                                    <option value="">Selecione um álbum</option>
                                    <option value="new-album">Criar Novo Álbum</option>
                                    <!-- Existing albums will be populated here by JS -->
                                </select>
                            </div>
                            <div class="form-group" id="newAlbumNameGroup" style="display: none;">
                                <label class="form-label" for="newAlbumName">Nome do Novo Álbum</label>
                                <input type="text" class="form-input" id="newAlbumName"
                                    placeholder="Digite o nome do novo álbum">
                            </div>
                            <div class="form-group" id="newAlbumCoverGroup" style="display: none;">
                                <label class="form-label">Capa do Novo Álbum</label>
                                <div class="file-input-wrapper">
                                    <label for="newAlbumCover" class="file-input-btn">
                                        <i class="fas fa-compact-disc"></i>
                                        <span id="newAlbumCoverFileName">Selecionar capa do novo álbum</span>
                                    </label>
                                    <input type="file" id="newAlbumCover" class="file-input-hidden" accept="image/*">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="musicDuration">Duração</label>
                                <input type="text" class="form-input" id="musicDuration" placeholder="Ex: 3:45"
                                    pattern="[0-9]+:[0-5][0-9]">
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">Arquivo de Áudio</label>
                                <div class="file-input-wrapper">
                                    <label for="musicAudio" class="file-input-btn">
                                        <i class="fas fa-music"></i>
                                        <span id="audioFileName">Selecionar arquivo de áudio</span>
                                    </label>
                                    <input type="file" id="musicAudio" class="file-input-hidden" accept="audio/*"
                                        required>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">Capa da Música (opcional)</label>
                                <div class="file-input-wrapper">
                                    <label for="musicCover" class="file-input-btn">
                                        <i class="fas fa-image"></i>
                                        <span id="coverFileName">Selecionar imagem da capa</span>
                                    </label>
                                    <input type="file" id="musicCover" class="file-input-hidden" accept="image/*">
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <button type="submit" class="btn" style="width: 100%;">
                                    <i class="fas fa-plus"></i>
                                    Adicionar Música
                                </button>
                            </div>
                        </form>
                    </div>

                    <div
                        style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 25px; margin-bottom: 30px;">
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <input type="text" class="form-input" id="playlistName" placeholder="Nome da nova playlist"
                                style="flex: 1;">
                            <button class="btn" onclick="createPlaylist()">Criar Playlist</button>
                        </div>
                    </div>

                    <div class="playlists-grid" id="playlistsGrid">
                        <!-- Playlists serão adicionadas aqui dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Player Sidebar -->
            <div class="player-sidebar">
                <!-- Search -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Pesquisar músicas..." id="searchInput">
                </div>

                <!-- Songs List -->
                <div class="songs-list">
                    <h3 class="songs-title">Músicas Recomendadas</h3>
                    <div id="songsList">
                        <!-- Songs will be populated here -->
                        <p style="text-align: center; opacity: 0.7;">Nenhuma música adicionada ainda.</p>
                    </div>
                </div>

                <!-- Music Player -->
                <div class="music-player">
                    <div class="current-song-cover" id="currentSongCover">
                        <img src="https://via.placeholder.com/120?text=No+Song" alt="Current Song" id="coverImage">
                        <div class="vinyl-center"></div>
                    </div>

                    <div class="current-song-title" id="currentSongTitle">Nenhuma Música</div>
                    <div class="current-song-artist" id="currentSongArtist"></div>

                    <div class="progress-container">
                        <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
                    </div>

                    <div class="player-controls">
                        <button class="control-btn" onclick="prevSong()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-pause" onclick="togglePlayPause()">
                            <i class="fas fa-play" id="playPauseIcon"></i>
                        </button>
                        <button class="control-btn" onclick="nextSong()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Controls -->
    <div class="floating-controls" id="floatingControls">
        <div class="floating-song-cover">
            <img src="https://via.placeholder.com/50?text=No+Song" alt="Current Song" id="floatingCoverImage">
        </div>

        <div class="floating-song-info">
            <div class="floating-song-title" id="floatingSongTitle">Nenhuma Música</div>
            <div class="floating-song-artist" id="floatingSongArtist"></div>
            <div class="floating-progress-container">
                <input type="range" class="floating-progress-bar" id="floatingProgressBar" min="0" max="100" value="0">
            </div>
        </div>

        <div class="floating-controls-buttons">
            <button class="control-btn" onclick="prevSong()">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn play-pause" onclick="togglePlayPause()">
                <i class="fas fa-play" id="floatingPlayPauseIcon"></i>
            </button>
            <button class="control-btn" onclick="nextSong()">
                <i class="fas fa-step-forward"></i>
            </button>
        </div>
    </div>

    <!-- Floating Maria Bonita Button -->
    <div class="maria-bonita-btn" onclick="openMariaBonitaModal()">
        <img src="https://i.postimg.cc/G2T1gFLb/Untitled-design-9.png" alt="Maria Bonita">
    </div>

    <!-- Maria Bonita Modal -->
    <div class="maria-bonita-modal" id="mariaBonitaModal">
        <div class="maria-bonita-modal-content">
            <button class="maria-bonita-modal-close" onclick="closeMariaBonitaModal()">
                <i class="fas fa-times"></i>
            </button>
            <h3>Anunciar com Maria Bonita</h3>
            <textarea id="mariaBonitaText" placeholder="Digite o que a Maria Bonita deve falar..."
                maxlength="18000"></textarea>
            <div class="char-counter">
                <span id="currentChars">0</span> / <span id="maxChars">18000</span> caracteres
            </div>
            <button onclick="speakMariaBonita()">Fazer Anúncio</button>
            <div class="maria-bonita-status" id="mariaBonitaStatus"></div>
        </div>
    </div>

    <!-- Playlist Modal -->
    <div id="playlistModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; backdrop-filter: blur(10px);">
        <div
            style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(16, 21, 61, 0.95); backdrop-filter: blur(20px); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 20px; padding: 30px; width: 90%; max-width: 800px; max-height: 80%; overflow-y: auto; color: white;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 id="modalPlaylistName" style="margin: 0;">Editar Playlist</h2>
                <button onclick="closePlaylistModal()"
                    style="background: rgba(220, 53, 69, 0.6); border: none; border-radius: 50%; color: white; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="margin-bottom: 15px;">Músicas Disponíveis</h3>
                    <div id="availableSongs" style="max-height: 400px; overflow-y: auto;">
                        <!-- Available songs will be populated here -->
                    </div>
                </div>

                <div>
                    <h3 style="margin-bottom: 15px;">Músicas na Playlist</h3>
                    <div id="playlistSongs" style="max-height: 400px; overflow-y: auto;">
                        <!-- Playlist songs will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // Global variables
        let currentSongIndex = 0;
        let isPlaying = false;
        let currentAudio = null;
        let currentEditingPlaylist = null;
        let originalVolume = 1.0; // To store original volume before Maria Bonita speaks

        // Ads system variables
        let loadedAds = [];
        let adsInterval = 5;
        let songsPlayedCount = 0;
        let currentAdIndex = 0;
        let adOrder = 'random';
        let scheduledAds = []; // New array for scheduled ads
        let scheduledAdTimeout = null; // To store the timeout ID for scheduled ads

        // Playlists system
        let playlists = [];

        // Albums system
        let albums = []; // New array to store album data

        // Play history for dynamic content
        let playHistory = {
            artists: {},
            albums: {},
            playlists: {}
        };

        // Songs data (empty initially)
        let songs = [];

        // Eleven Labs API variables
        const ELEVEN_LABS_API_KEY = 'bff5c5707c4689a6e274778fcabf4220d2301b58a9bd850ec5047ef7f637099e'; // Replace with your actual API Key
        const ELEVEN_LABS_VOICE_ID = 'EXAVITQu4vr4xnSDxMaL'; // Female voice ID for Portuguese (e.g., "Raquel" or another suitable one)
        const MAX_CHARS_MONTHLY = 18000;
        let charsUsedThisMonth = 0;
        let lastResetDate = null;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDoDFfp_Rg1ABlUoL3Ay--fie94BVqwJF8",
            authDomain: "maria-bonita-player.firebaseapp.com",
            projectId: "maria-bonita-player",
            storageBucket: "maria-bonita-player.firebasestorage.app",
            messagingSenderId: "256876491064",
            appId: "1:256876491064:web:c53133f4fc3f3f66bc11cd", // Corrected appId
            measurementId: "G-W3WGJD0FRP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Login Screen Elements
        const loginScreen = document.getElementById('loginScreen');
        const loginEmailInput = document.getElementById('loginEmail');
        const loginPasswordInput = document.getElementById('loginPassword');
        const loginButton = document.getElementById('loginButton');
        const loginStatus = document.getElementById('loginStatus');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const welcomeUsername = document.getElementById('welcomeUsername');
        const mainContainer = document.querySelector('.main-container');

        // GIF Control Elements
        const gifCanvas = document.getElementById('gifCanvas');
        const animatedGif = document.getElementById('animatedGif');
        const ctx = gifCanvas.getContext('2d');
        const gifImage = new Image();
        gifImage.src = animatedGif.src;

        gifImage.onload = () => {
            gifCanvas.width = gifImage.width;
            gifCanvas.height = gifImage.height;
            ctx.drawImage(gifImage, 0, 0, gifImage.width, gifImage.height);
            animatedGif.style.display = 'none'; // Hide animated GIF initially
            gifCanvas.style.display = 'block'; // Show canvas with first frame
        };

        // Login Function
        loginButton.addEventListener('click', async () => {
            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;

            loginStatus.textContent = 'Autenticando...';
            loginButton.disabled = true;

            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                loginStatus.textContent = ''; // Clear status
                loginEmailInput.style.display = 'none';
                loginPasswordInput.style.display = 'none';
                loginButton.style.display = 'none';

                // Show animated GIF
                gifCanvas.style.display = 'none';
                animatedGif.style.display = 'block';

                // Display welcome message
                welcomeMessage.textContent = 'Bem-Vindo(a)';
                welcomeMessage.classList.add('show');

                let displayName = user.displayName || user.email.split('@')[0]; // Fallback to email part
                welcomeUsername.textContent = displayName;
                welcomeUsername.classList.add('show');

                // Transition to main content after 4 seconds
                setTimeout(() => {
                    loginScreen.style.display = 'none';
                    mainContainer.style.display = 'grid'; // Or 'flex' depending on your main-container display
                    initializeApp(); // Initialize the main app
                }, 4000); // 4 seconds
            } catch (error) {
                console.error("Erro de login:", error);
                let errorMessage = "Erro ao fazer login. Por favor, tente novamente.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = "E-mail ou senha inválidos.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Formato de e-mail inválido.";
                }
                loginStatus.textContent = errorMessage;
                loginButton.disabled = false;
                // Reset GIF to paused state if login fails
                gifCanvas.style.display = 'block';
                animatedGif.style.display = 'none';
                welcomeMessage.classList.remove('show');
                welcomeUsername.classList.remove('show');
                loginEmailInput.style.display = 'block';
                loginPasswordInput.style.display = 'block';
                loginButton.style.display = 'block';
            }
        });

        // Initialize the application (called after successful login)
        function initializeApp() {
            loadAlbums(); // Load albums first
            renderSongsList();
            updateCurrentSong();
            initializeNavigation();
            initializePlayer();
            initializeAdsSystem();
            initializePlaylistsSystem();
            initializeSwiper();
            initializeAddMusicForm();
            loadSavedData(); // This will now load from an empty localStorage
            populateAlbumSelect(); // Populate album select after loading albums
            updateFeaturedArtists(); // Update artists based on loaded data (will be empty)
            updateRecommendedAlbums(); // Update albums based on loaded data (will be empty)
            updatePopularPlaylists(); // Update popular playlists based on loaded data (will be empty)
            setupFloatingControlsHover(); // Setup hover functionality for floating controls
            loadCharacterUsage(); // Load Eleven Labs character usage
            updateMariaBonitaCharCounter(); // Update character counter display
            loadScheduledAds(); // Load scheduled ads
            startScheduledAdChecker(); // Start checking for scheduled ads
        }

        // Album Management Functions
        function loadAlbums() {
            const savedAlbums = localStorage.getItem('musicPlayer_albums');
            if (savedAlbums) {
                albums = JSON.parse(savedAlbums);
            } else {
                albums = []; // Start with an empty array if no saved data
                saveAlbums();
            }
        }

        function saveAlbums() {
            localStorage.setItem('musicPlayer_albums', JSON.stringify(albums));
        }

        function getAlbumByNameAndArtist(albumName, artistName) {
            return albums.find(album => album.name === albumName && album.artist === artistName);
        }

        function addOrUpdateAlbum(albumName, artistName, coverUrl) {
            let album = getAlbumByNameAndArtist(albumName, artistName);
            if (album) {
                if (coverUrl) album.cover = coverUrl;
            } else {
                album = { name: albumName, artist: artistName, cover: coverUrl || "https://via.placeholder.com/150?text=Album+Cover" };
                albums.push(album);
            }
            saveAlbums();
            populateAlbumSelect(); // Re-populate select to show new/updated album
            updateRecommendedAlbums(); // Re-render recommended albums
            return album;
        }

        // Initialize Add Music Form
        function initializeAddMusicForm() {
            const form = document.getElementById('addMusicForm');
            const audioInput = document.getElementById('musicAudio');
            const coverInput = document.getElementById('musicCover');
            const artistCoverInput = document.getElementById('artistCover'); // New
            const newAlbumCoverInput = document.getElementById('newAlbumCover'); // New

            const audioFileName = document.getElementById('audioFileName');
            const coverFileName = document.getElementById('coverFileName');
            const artistCoverFileName = document.getElementById('artistCoverFileName'); // New
            const newAlbumCoverFileName = document.getElementById('newAlbumCoverFileName'); // New

            // Update file names when files are selected
            audioInput.addEventListener('change', function () {
                audioFileName.textContent = this.files.length > 0 ? this.files[0].name : 'Selecionar arquivo de áudio';
            });

            coverInput.addEventListener('change', function () {
                coverFileName.textContent = this.files.length > 0 ? this.files[0].name : 'Selecionar imagem da capa';
            });

            artistCoverInput.addEventListener('change', function () {
                artistCoverFileName.textContent = this.files.length > 0 ? this.files[0].name : 'Selecionar capa do artista';
            });

            newAlbumCoverInput.addEventListener('change', function () {
                newAlbumCoverFileName.textContent = this.files.length > 0 ? this.files[0].name : 'Selecionar capa do novo álbum';
            });

            // Handle form submission
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                addNewMusic();
            });
        }

        // Toggle new album fields visibility
        function toggleNewAlbumFields() {
            const albumSelect = document.getElementById('musicAlbumSelect');
            const newAlbumNameGroup = document.getElementById('newAlbumNameGroup');
            const newAlbumCoverGroup = document.getElementById('newAlbumCoverGroup');

            if (albumSelect.value === 'new-album') {
                newAlbumNameGroup.style.display = 'block';
                newAlbumCoverGroup.style.display = 'block';
                document.getElementById('newAlbumName').setAttribute('required', 'required');
            } else {
                newAlbumNameGroup.style.display = 'none';
                newAlbumCoverGroup.style.display = 'none';
                document.getElementById('newAlbumName').removeAttribute('required');
            }
        }

        // Populate album select dropdown
        function populateAlbumSelect() {
            const albumSelect = document.getElementById('musicAlbumSelect');
            const selectedValue = albumSelect.value; // Preserve current selection

            // Clear existing options except the first two
            while (albumSelect.children.length > 2) {
                albumSelect.removeChild(albumSelect.lastChild);
            }

            // Add existing albums
            albums.sort((a, b) => a.name.localeCompare(b.name)).forEach(album => {
                const option = document.createElement('option');
                option.value = album.name;
                option.textContent = `${album.name} (${album.artist})`;
                albumSelect.appendChild(option);
            });

            // Restore selection
            albumSelect.value = selectedValue;
            toggleNewAlbumFields(); // Ensure fields are correctly displayed based on restored value
        }

        // Add new music function
        async function addNewMusic() {
            const title = document.getElementById('musicTitle').value.trim();
            const artist = document.getElementById('musicArtist').value.trim();
            const albumSelectValue = document.getElementById('musicAlbumSelect').value;
            const duration = document.getElementById('musicDuration').value.trim() || '3:00';
            const audioFile = document.getElementById('musicAudio').files[0];
            const musicCoverFile = document.getElementById('musicCover').files[0];
            const artistCoverFile = document.getElementById('artistCover').files[0]; // New
            const newAlbumName = document.getElementById('newAlbumName').value.trim(); // New
            const newAlbumCoverFile = document.getElementById('newAlbumCover').files[0]; // New

            if (!title || !artist || !audioFile || !albumSelectValue) {
                alert('Por favor, preencha os campos obrigatórios (Título, Artista, Álbum e Arquivo de Áudio).');
                return;
            }

            if (albumSelectValue === 'new-album' && !newAlbumName) {
                alert('Por favor, digite o nome do novo álbum.');
                return;
            }

            // Create audio URL
            const audioURL = URL.createObjectURL(audioFile);

            // Default cover or use uploaded music cover
            let musicCoverURL = "https://via.placeholder.com/150?text=Music+Cover"; // Generic placeholder
            if (musicCoverFile) {
                musicCoverURL = URL.createObjectURL(musicCoverFile);
            }

            // Handle artist cover
            let artistCoverURL = "https://via.placeholder.com/100?text=Artist"; // Generic placeholder
            if (artistCoverFile) {
                artistCoverURL = URL.createObjectURL(artistCoverFile);
                // Update artist image in playHistory if it's a new image for an existing artist
                if (playHistory.artists[artist]) {
                    playHistory.artists[artist].cover = artistCoverURL;
                }
            }

            // Handle album creation/selection
            let finalAlbumName = albumSelectValue;
            let albumCoverURL = "https://via.placeholder.com/150?text=Album+Cover"; // Generic placeholder

            if (albumSelectValue === 'new-album') {
                finalAlbumName = newAlbumName;
                if (newAlbumCoverFile) {
                    albumCoverURL = URL.createObjectURL(newAlbumCoverFile);
                }
                addOrUpdateAlbum(finalAlbumName, artist, albumCoverURL); // Add new album
            } else {
                const existingAlbum = getAlbumByNameAndArtist(albumSelectValue, artist);
                if (existingAlbum) {
                    albumCoverURL = existingAlbum.cover;
                } else {
                    // This case should ideally not happen if populateAlbumSelect is correct,
                    // but as a fallback, create a new album.
                    addOrUpdateAlbum(albumSelectValue, artist, albumCoverURL);
                }
            }

            // Create new song object
            const newSong = {
                title: title,
                artist: artist,
                album: finalAlbumName,
                duration: duration,
                cover: musicCoverURL,
                audio: audioURL,
                artistCover: artistCoverURL // Store artist cover with the song
            };

            // Add to songs array
            songs.push(newSong);

            // Re-render songs list
            renderSongsList();

            // Clear form
            document.getElementById('addMusicForm').reset();
            document.getElementById('audioFileName').textContent = 'Selecionar arquivo de áudio';
            document.getElementById('coverFileName').textContent = 'Selecionar imagem da capa';
            document.getElementById('artistCoverFileName').textContent = 'Selecionar capa do artista';
            document.getElementById('newAlbumCoverFileName').textContent = 'Selecionar capa do novo álbum';
            populateAlbumSelect(); // Re-populate to reset the select and hide new album fields

            // Save to localStorage
            localStorage.setItem('musicPlayer_songs', JSON.stringify(songs));

            alert('Música adicionada com sucesso!');
        }

        // Render songs list
        function renderSongsList() {
            const songsList = document.getElementById('songsList');
            if (songs.length === 0) {
                songsList.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nenhuma música adicionada ainda.</p>';
                return;
            }
            songsList.innerHTML = songs.map((song, index) => `
                <div class="song-item" data-index="${index}">
                    <div class="song-cover">
                        <img src="${song.cover}" alt="${song.title}">
                        <div class="song-cover-overlay" onclick="playSong(${index})">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="song-cover-change" onclick="event.stopPropagation()">
                            <i class="fas fa-camera"></i>
                            <input type="file" class="song-cover-input" accept="image/*" onchange="updateSongCover(${index}, this)">
                        </div>
                    </div>
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                        <div class="song-album" style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6);">${song.album}</div>
                    </div>
                    <div class="song-duration">${song.duration}</div>
                </div>
            `).join('');
        }

        // Update current song display
        function updateCurrentSong() {
            const defaultCover = "https://via.placeholder.com/120?text=No+Song"; // Generic placeholder image

            if (songs.length > 0 && currentSongIndex >= 0 && currentSongIndex < songs.length) {
                const song = songs[currentSongIndex];

                // Update main player
                document.getElementById('currentSongTitle').textContent = song.title;
                document.getElementById('currentSongArtist').textContent = song.artist;
                document.getElementById('coverImage').src = song.cover;

                // Update floating controls
                document.getElementById('floatingSongTitle').textContent = song.title;
                document.getElementById('floatingSongArtist').textContent = song.artist;
                document.getElementById('floatingCoverImage').src = song.cover;

                // Update active song in list
                document.querySelectorAll('.song-item').forEach((item, index) => {
                    item.classList.toggle('playing', index === currentSongIndex);
                });
            } else {
                // If no songs are loaded, display default placeholder
                document.getElementById('currentSongTitle').textContent = "Nenhuma Música";
                document.getElementById('currentSongArtist').textContent = "";
                document.getElementById('coverImage').src = defaultCover;
                document.getElementById('floatingSongTitle').textContent = "Nenhuma Música";
                document.getElementById('floatingSongArtist').textContent = "";
                document.getElementById('floatingCoverImage').src = "https://via.placeholder.com/50?text=No+Song";
                document.querySelectorAll('.song-item').forEach(item => item.classList.remove('playing'));
            }
        }

        // Play/pause functionality
        function togglePlayPause() {
            if (songs.length === 0) {
                alert('Por favor, adicione músicas para começar a tocar.');
                return;
            }
            if (isPlaying) {
                pauseMusic();
            } else {
                playMusic();
            }
        }

        function playMusic() {
            if (songs.length === 0) return; // Prevent playing if no songs

            if (currentAudio) {
                currentAudio.pause();
            }

            currentAudio = new Audio(songs[currentSongIndex].audio);
            currentAudio.play();

            isPlaying = true;
            document.getElementById('playPauseIcon').className = 'fas fa-pause';
            document.getElementById('floatingPlayPauseIcon').className = 'fas fa-pause';
            document.getElementById('currentSongCover').classList.add('rotating');

            // Store original volume
            originalVolume = currentAudio.volume;

            // Track play history
            trackPlayHistory();

            currentAudio.addEventListener('ended', () => {
                // Increment song count only when song ends completely
                songsPlayedCount++;
                updateAdCounter();

                // Check if we should play an ad after this song
                if (shouldPlayAd()) {
                    playRandomAd();
                } else {
                    nextSong();
                }
            });

            currentAudio.addEventListener('timeupdate', () => {
                if (currentAudio.duration) {
                    const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                    document.getElementById('progressBar').value = progress;
                    document.getElementById('floatingProgressBar').value = progress;

                    // Check for ad countdown (30 seconds before end)
                    const timeRemaining = currentAudio.duration - currentAudio.currentTime;
                    if (shouldPlayAd() && timeRemaining <= 30 && timeRemaining > 29 && !document.getElementById('adCountdownOverlay')) {
                        showProgressCountdown();
                    }
                }
            });
        }

        function pauseMusic() {
            if (currentAudio) {
                currentAudio.pause();
            }

            isPlaying = false;
            document.getElementById('playPauseIcon').className = 'fas fa-play';
            document.getElementById('floatingPlayPauseIcon').className = 'fas fa-play';
            document.getElementById('currentSongCover').classList.remove('rotating');
        }

        function playSong(index) {
            if (index < 0 || index >= songs.length) return; // Ensure valid index
            currentSongIndex = index;
            updateCurrentSong();
            if (isPlaying) {
                pauseMusic();
            }
            playMusic();
        }

        function nextSong() {
            if (songs.length === 0) return;
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            updateCurrentSong();
            if (isPlaying) {
                playMusic();
            }
        }

        function prevSong() {
            if (songs.length === 0) return;
            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
            updateCurrentSong();
            if (isPlaying) {
                playMusic();
            }
        }

        // Track play history for dynamic sections
        function trackPlayHistory() {
            if (songs.length === 0) return;
            const song = songs[currentSongIndex];

            // Track artist
            if (!playHistory.artists[song.artist]) {
                playHistory.artists[song.artist] = { count: 0, lastPlayed: Date.now(), cover: song.artistCover || "https://via.placeholder.com/100?text=Artist" };
            }
            playHistory.artists[song.artist].count++;
            playHistory.artists[song.artist].lastPlayed = Date.now();

            // Track album
            if (!playHistory.albums[song.album]) {
                playHistory.albums[song.album] = { count: 0, artist: song.artist, lastPlayed: Date.now(), cover: getAlbumCover(song.album, song.artist) };
            }
            playHistory.albums[song.album].count++;
            playHistory.albums[song.album].lastPlayed = Date.now();

            // Update dynamic sections
            updateFeaturedArtists();
            updateRecommendedAlbums();
        }

        // Update featured artists dynamically
        function updateFeaturedArtists() {
            const artistsContainer = document.getElementById('featuredArtistsContainer');
            const sortedArtists = Object.entries(playHistory.artists)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 8);

            if (sortedArtists.length > 0) {
                artistsContainer.innerHTML = sortedArtists.map(([artistName, data]) => {
                    const artistImage = data.cover || "https://via.placeholder.com/100?text=Artist"; // Use stored cover or generic default
                    return `
                        <div class="artist-card">
                            <div class="artist-image">
                                <img src="${artistImage}" alt="${artistName}">
                            </div>
                            <div class="artist-name">${artistName}</div>
                        </div>
                    `;
                }).join('');
            } else {
                artistsContainer.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhum artista em destaque ainda.</p>';
            }
        }

        // Update recommended albums dynamically
        function updateRecommendedAlbums() {
            const albumsContainer = document.getElementById('recommendedAlbumsContainer');
            const sortedAlbums = Object.entries(playHistory.albums)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 6);

            if (sortedAlbums.length > 0) {
                albumsContainer.innerHTML = sortedAlbums.map(([albumName, data]) => {
                    const albumCover = data.cover || "https://via.placeholder.com/150?text=Album+Cover"; // Use stored cover or generic default
                    return `
                        <div class="album-card">
                            <div class="album-cover">
                                <img src="${albumCover}" alt="${albumName}">
                                <div class="album-cover-change" onclick="changeAlbumCover('${albumName}', event)">
                                    <i class="fas fa-camera"></i>
                                </div>
                            </div>
                            <div class="album-title">${albumName}</div>
                            <div class="album-artist">${data.artist}</div>
                        </div>
                    `;
                }).join('');
            } else {
                albumsContainer.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhum álbum recomendado ainda.</p>';
            }
        }

        // Helper functions to get images (now only generic placeholders)
        function getArtistImage(artistName) {
            // This function is now primarily for fallback if artistCover is not explicitly set
            if (playHistory.artists[artistName] && playHistory.artists[artistName].cover) {
                return playHistory.artists[artistName].cover;
            }
            const songWithArtistCover = songs.find(s => s.artist === artistName && s.artistCover && s.artistCover !== "https://via.placeholder.com/100?text=Artist");
            if (songWithArtistCover) {
                return songWithArtistCover.artistCover;
            }
            return "https://via.placeholder.com/100?text=Artist";
        }

        function getAlbumCover(albumName, artistName = null) {
            const album = albums.find(a => a.name === albumName && (artistName ? a.artist === artistName : true));
            if (album && album.cover) {
                return album.cover;
            }
            return "https://via.placeholder.com/150?text=Album+Cover";
        }

        // Change album cover function
        function changeAlbumCover(albumName, event) {
            event.stopPropagation(); // Prevent triggering album card click
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const newCoverUrl = event.target.result;
                        // Find the album and update its cover
                        const albumToUpdate = albums.find(a => a.name === albumName);
                        if (albumToUpdate) {
                            albumToUpdate.cover = newCoverUrl;
                            saveAlbums();
                            updateRecommendedAlbums(); // Re-render albums grid
                            // Also update playHistory if this album is tracked there
                            if (playHistory.albums[albumName]) {
                                playHistory.albums[albumName].cover = newCoverUrl;
                            }
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Ads functionality
        function shouldPlayAd() {
            return loadedAds.length > 0 && songsPlayedCount > 0 && songsPlayedCount % adsInterval === 0;
        }

        // Show countdown overlay on progress bar
        function showProgressCountdown() {
            const progressContainer = document.querySelector('.progress-container');
            let countdownOverlay = document.getElementById('adCountdownOverlay');

            if (!countdownOverlay) {
                countdownOverlay = document.createElement('div');
                countdownOverlay.className = 'progress-countdown-overlay';
                countdownOverlay.id = 'adCountdownOverlay';
                progressContainer.style.position = 'relative';
                progressContainer.appendChild(countdownOverlay);
            }

            let countdown = 30;
            countdownOverlay.innerHTML = `Anúncio em ${countdown}s`;

            const countdownInterval = setInterval(() => {
                countdown--;
                countdownOverlay.innerHTML = `Anúncio em ${countdown}s`;

                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    if (countdownOverlay.parentNode) {
                        countdownOverlay.parentNode.removeChild(countdownOverlay);
                    }

                    // Pause current music and play ad
                    if (currentAudio) {
                        currentAudio.pause();
                    }
                    playRandomAd();
                }
            }, 1000);
        }

        function playRandomAd() {
            if (loadedAds.length === 0) return;

            let adToPlay;
            if (adOrder === 'random') {
                adToPlay = loadedAds[Math.floor(Math.random() * loadedAds.length)];
            } else {
                adToPlay = loadedAds[currentAdIndex % loadedAds.length];
                currentAdIndex++;
            }

            playAdWithVolumeControl(adToPlay);
        }

        function showAdCountdown(ad) {
            // Create countdown notification
            const adNotification = document.createElement('div');
            adNotification.className = 'ad-notification';
            adNotification.innerHTML = `
                <h3>Anúncio</h3>
                <p>O anúncio iniciará em:</p>
                <div class="countdown" id="adCountdown">3</div>
                <p>Aguarde...</p>
            `;

            document.body.appendChild(adNotification);

            let countdown = 3;
            const countdownElement = document.getElementById('adCountdown');

            const countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    if (adNotification.parentNode) {
                        document.body.removeChild(adNotification);
                    }

                    // Show "Playing Ad" notification
                    showPlayingAdNotification();

                    // Play the ad
                    playAdWithVolumeControl(ad);
                }
            }, 1000);
        }

        function showPlayingAdNotification() {
            const adNotification = document.createElement('div');
            adNotification.className = 'ad-playing-notification';
            adNotification.id = 'playingAdNotification';
            adNotification.innerHTML = `
                <h3>Reproduzindo Anúncio</h3>
                <div class="spinner"></div>
                <p>Aguarde o término do anúncio...</p>
            `;

            document.body.appendChild(adNotification);
        }

        function hidePlayingAdNotification() {
            const notification = document.getElementById('playingAdNotification');
            if (notification) {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 500); // Wait for fade-out animation to complete
            }
        }

        function updateAdCounter() {
            const nextAdCounter = document.getElementById('nextAdCounter');
            if (nextAdCounter) {
                const remainingSongs = adsInterval - (songsPlayedCount % adsInterval);
                nextAdCounter.textContent = `${remainingSongs} música${remainingSongs !== 1 ? 's' : ''}`;
            }
        }

        // Navigation functionality
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-section]');
            const sections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionName = link.getAttribute('data-section');

                    // Remove active class from all nav links
                    navLinks.forEach(nav => nav.classList.remove('active'));

                    // Add active class to clicked link
                    link.classList.add('active');

                    // Hide all sections
                    sections.forEach(section => section.classList.remove('active'));

                    // Show selected section
                    const targetSection = document.getElementById(`${sectionName}-section`);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                });
            });
        }

        // Initialize player controls
        function initializePlayer() {
            // Progress bar controls
            const progressBar = document.getElementById('progressBar');
            const floatingProgressBar = document.getElementById('floatingProgressBar');

            progressBar.addEventListener('input', () => {
                if (currentAudio) {
                    const seekTime = (progressBar.value / 100) * currentAudio.duration;
                    currentAudio.currentTime = seekTime;
                    floatingProgressBar.value = progressBar.value;
                }
            });

            floatingProgressBar.addEventListener('input', () => {
                if (currentAudio) {
                    const seekTime = (floatingProgressBar.value / 100) * currentAudio.duration;
                    currentAudio.currentTime = seekTime;
                    progressBar.value = floatingProgressBar.value;
                }
            });
        }

        // Initialize ads system
        function initializeAdsSystem() {
            const adsUpload = document.getElementById('adsUpload');
            const adsIntervalSelect = document.getElementById('adsInterval');
            const adOrderSelect = document.getElementById('adOrder');

            adsUpload.addEventListener('change', handleAdsUpload);
            adsIntervalSelect.addEventListener('change', (e) => {
                adsInterval = parseInt(e.target.value);
                updateAdCounter();
            });
            adOrderSelect.addEventListener('change', (e) => {
                adOrder = e.target.value;
            });

            updateAdCounter();
            populateScheduledAdSelect(); // Populate the select for scheduled ads
        }

        function handleAdsUpload(event) {
            const files = Array.from(event.target.files);
            const adsList = document.getElementById('adsList');
            const adStatus = document.getElementById('adStatus');

            files.forEach(file => {
                if (file.type.startsWith('audio/')) {
                    const adUrl = URL.createObjectURL(file);
                    const ad = {
                        id: Date.now() + Math.random().toString(36).substring(2, 9), // Unique ID
                        name: file.name,
                        url: adUrl,
                        duration: '0:30' // Default duration, could be calculated
                    };

                    loadedAds.push(ad);
                }
            });
            saveLoadedAds(); // Save loaded ads to localStorage
            renderLoadedAds(); // Render loaded ads
            populateScheduledAdSelect(); // Update the select for scheduled ads
        }

        function saveLoadedAds() {
            localStorage.setItem('musicPlayer_loadedAds', JSON.stringify(loadedAds.map(ad => ({ id: ad.id, name: ad.name, url: ad.url, duration: ad.duration }))));
        }

        function loadLoadedAds() {
            const savedAds = localStorage.getItem('musicPlayer_loadedAds');
            if (savedAds) {
                loadedAds = JSON.parse(savedAds);
            }
        }

        function renderLoadedAds() {
            const adsList = document.getElementById('adsList');
            const adStatus = document.getElementById('adStatus');

            if (loadedAds.length > 0) {
                adStatus.textContent = `${loadedAds.length} anúncio${loadedAds.length !== 1 ? 's' : ''} carregado${loadedAds.length !== 1 ? 's' : ''}`;
                adsList.innerHTML = loadedAds.map((ad, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 5px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                        <span>${ad.name}</span>
                        <button onclick="removeAd('${ad.id}')" style="background: rgba(220, 53, 69, 0.6); border: none; border-radius: 5px; color: white; padding: 5px 10px; cursor: pointer;">
                            Remover
                        </button>
                    </div>
                `).join('');
            } else {
                adStatus.textContent = 'Anúncios desativados';
                adsList.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nenhum anúncio carregado ainda.</p>';
            }
        }

        function removeAd(adId) {
            loadedAds = loadedAds.filter(ad => ad.id !== adId);
            saveLoadedAds();
            renderLoadedAds();
            populateScheduledAdSelect();
            // Also remove from scheduled ads if it was scheduled
            scheduledAds = scheduledAds.filter(scheduledAd => scheduledAd.adId !== adId);
            saveScheduledAds();
            renderScheduledAds();
        }

        function populateScheduledAdSelect() {
            const select = document.getElementById('scheduledAdSelect');
            select.innerHTML = '<option value="">Selecione um anúncio carregado</option>';
            loadedAds.forEach(ad => {
                const option = document.createElement('option');
                option.value = ad.id;
                option.textContent = ad.name;
                select.appendChild(option);
            });
        }

        function scheduleAd() {
            const adId = document.getElementById('scheduledAdSelect').value;
            const time = document.getElementById('scheduledAdTime').value;

            if (!adId || !time) {
                alert('Por favor, selecione um anúncio e defina a hora.');
                return;
            }

            const selectedAd = loadedAds.find(ad => ad.id === adId);
            if (!selectedAd) {
                alert('Anúncio selecionado não encontrado.');
                return;
            }

            const [hours, minutes] = time.split(':').map(Number);
            const now = new Date();
            const scheduledTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);

            if (scheduledTime <= now) {
                alert('Por favor, selecione uma hora futura para programar o anúncio.');
                return;
            }

            const newScheduledAd = {
                id: Date.now().toString(),
                adId: adId,
                adName: selectedAd.name,
                scheduledTime: scheduledTime.toISOString(),
                played: false
            };

            scheduledAds.push(newScheduledAd);
            saveScheduledAds();
            renderScheduledAds();
            alert(`Anúncio "${selectedAd.name}" programado para ${time}.`);

            // Clear form
            document.getElementById('scheduledAdSelect').value = '';
            document.getElementById('scheduledAdTime').value = '';
        }

        function saveScheduledAds() {
            localStorage.setItem('musicPlayer_scheduledAds', JSON.stringify(scheduledAds));
        }

        function loadScheduledAds() {
            const saved = localStorage.getItem('musicPlayer_scheduledAds');
            if (saved) {
                scheduledAds = JSON.parse(saved);
            }
            renderScheduledAds();
        }

        function renderScheduledAds() {
            const listContainer = document.getElementById('scheduledAdsList');
            if (scheduledAds.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nenhum anúncio programado ainda.</p>';
                return;
            }

            listContainer.innerHTML = scheduledAds.map(ad => {
                const scheduledDate = new Date(ad.scheduledTime);
                const timeString = scheduledDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const dateString = scheduledDate.toLocaleDateString('pt-BR');
                const status = ad.played ? ' (Reproduzido)' : '';
                const playingClass = ad.playingNow ? 'playing-now' : '';

                return `
                    <div class="scheduled-ad-item ${playingClass}">
                        <div class="scheduled-ad-info">
                            <strong>${ad.adName}</strong>
                            <span>Programado para: ${dateString} ${timeString}${status}</span>
                        </div>
                        <div class="scheduled-ad-actions">
                            <button onclick="removeScheduledAd('${ad.id}')">Remover</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeScheduledAd(id) {
            scheduledAds = scheduledAds.filter(ad => ad.id !== id);
            saveScheduledAds();
            renderScheduledAds();
        }

        function startScheduledAdChecker() {
            // Clear any existing checker to prevent duplicates
            if (scheduledAdTimeout) {
                clearInterval(scheduledAdTimeout);
            }

            scheduledAdTimeout = setInterval(() => {
                const now = new Date();
                let shouldRender = false;

                scheduledAds.forEach(ad => {
                    if (!ad.played) {
                        const scheduledTime = new Date(ad.scheduledTime);
                        // Check if the scheduled time is within the last minute and not yet played
                        // This gives a small window to trigger if the exact second is missed
                        if (now >= scheduledTime && now.getTime() - scheduledTime.getTime() < 60000) {
                            const loadedAd = loadedAds.find(la => la.id === ad.adId);
                            if (loadedAd) {
                                console.log(`Playing scheduled ad: ${ad.adName}`);
                                playAdWithVolumeControl(loadedAd, true, ad.id); // Pass scheduledAdId
                                ad.played = true;
                                shouldRender = true;
                            } else {
                                console.warn(`Scheduled ad "${ad.adName}" (ID: ${ad.adId}) not found in loaded ads.`);
                                ad.played = true; // Mark as played to avoid repeated warnings
                                shouldRender = true;
                            }
                        }
                    }
                });

                if (shouldRender) {
                    saveScheduledAds();
                    renderScheduledAds();
                }
            }, 5000); // Check every 5 seconds
        }

        function playAdWithVolumeControl(adToPlay, isScheduled = false, scheduledAdId = null) {
            // Pause current music and lower its volume gradually
            if (currentAudio && !currentAudio.paused) {
                originalVolume = currentAudio.volume; // Save current volume
                let currentVolume = originalVolume;
                const fadeOutInterval = setInterval(() => {
                    currentVolume = Math.max(0, currentVolume - 0.05); // Decrease by 0.05
                    currentAudio.volume = currentVolume;
                    if (currentVolume <= 0) {
                        clearInterval(fadeOutInterval);
                        currentAudio.pause();
                        startAdPlayback();
                    }
                }, 50); // Adjust fade out speed
            } else {
                startAdPlayback();
            }

            function startAdPlayback() {
                if (currentAudio) {
                    currentAudio.pause(); // Ensure previous audio is stopped
                }

                currentAudio = new Audio(adToPlay.url);
                currentAudio.volume = 1.0; // Play ad at full volume
                currentAudio.play();

                isPlaying = false; // Mark player as not playing regular music
                document.getElementById('playPauseIcon').className = 'fas fa-play';
                document.getElementById('floatingPlayPauseIcon').className = 'fas fa-play';
                document.getElementById('currentSongCover').classList.remove('rotating');

                // Mark scheduled ad as playing now in UI
                if (isScheduled && scheduledAdId) {
                    const scheduledAdItem = scheduledAds.find(sa => sa.id === scheduledAdId);
                    if (scheduledAdItem) {
                        scheduledAdItem.playingNow = true;
                        renderScheduledAds();
                    }
                }

                showPlayingAdNotification(); // Show "Playing Ad" notification

                currentAudio.addEventListener('ended', () => {
                    hidePlayingAdNotification(); // Hide "Playing Ad" notification

                    // Mark scheduled ad as not playing now
                    if (isScheduled && scheduledAdId) {
                        const scheduledAdItem = scheduledAds.find(sa => sa.id === scheduledAdId);
                        if (scheduledAdItem) {
                            scheduledAdItem.playingNow = false;
                            renderScheduledAds();
                        }
                    }

                    // Fade in music volume gradually
                    if (currentAudio && originalVolume > 0) { // Check if there was music playing before
                        currentAudio.volume = 0; // Start from 0
                        let currentVolume = 0;
                        const fadeInInterval = setInterval(() => {
                            currentVolume = Math.min(originalVolume, currentVolume + 0.05); // Increase by 0.05
                            currentAudio.volume = currentVolume;
                            if (currentVolume >= originalVolume) {
                                clearInterval(fadeInInterval);
                            }
                        }, 50); // Adjust fade in speed
                    }

                    // Resume music after ad
                    if (!isScheduled) { // Only resume if it was a regular ad break
                        songsPlayedCount = 0; // Reset song counter after ad
                        updateAdCounter();
                        nextSong();
                    } else {
                        // If it was a scheduled ad, just ensure music resumes if it was playing
                        if (isPlaying) { // Check if music was playing before the ad
                            playMusic(); // Resume the current song
                        }
                    }
                });
            }
        }


        // Initialize playlists system
        function initializePlaylistsSystem() {
            loadPlaylists();
            renderPlaylists();
        }

        function createPlaylist() {
            const playlistName = document.getElementById('playlistName').value.trim();

            if (!playlistName) {
                alert('Por favor, digite um nome para a playlist.');
                return;
            }

            const playlist = {
                id: Date.now().toString(),
                name: playlistName,
                songs: [],
                cover: null,
                createdAt: new Date().toISOString()
            };

            playlists.push(playlist);
            savePlaylists();
            renderPlaylists();
            document.getElementById('playlistName').value = '';
        }

        function renderPlaylists() {
            const playlistsGrid = document.getElementById('playlistsGrid');

            if (playlists.length === 0) {
                playlistsGrid.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhuma playlist criada ainda.</p>';
                return;
            }

            playlistsGrid.innerHTML = playlists.map(playlist => `
                <div class="playlist-card">
                    <div class="playlist-cover" onclick="changePlaylistCover('${playlist.id}')">
                        ${playlist.cover ? `<img src="${playlist.cover}" alt="${playlist.name}">` : '<i class="fas fa-music"></i>'}
                    </div>
                    <div class="playlist-title">${playlist.name}</div>
                    <div class="playlist-count">${playlist.songs.length} música${playlist.songs.length !== 1 ? 's' : ''}</div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                        <button onclick="playPlaylist('${playlist.id}')" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 5px; color: white; padding: 8px 12px; cursor: pointer; font-size: 0.8rem;">
                            Tocar
                        </button>
                        <button onclick="editPlaylist('${playlist.id}')" style="background: rgba(255, 255, 255, 0.2); border: none; border-radius: 5px; color: white; padding: 8px 12px; cursor: pointer; font-size: 0.8rem;">
                            Editar
                        </button>
                        <button onclick="deletePlaylist('${playlist.id}')" style="background: rgba(220, 53, 69, 0.6); border: none; border-radius: 5px; color: white; padding: 8px 12px; cursor: pointer; font-size: 0.8rem;">
                            Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function playPlaylist(playlistId) {
            const playlist = playlists.find(p => p.id === playlistId);
            if (!playlist || playlist.songs.length === 0) {
                alert('Esta playlist está vazia.');
                return;
            }

            // Track playlist play
            if (!playHistory.playlists[playlist.name]) {
                playHistory.playlists[playlist.name] = { count: 0, lastPlayed: Date.now() };
            }
            playHistory.playlists[playlist.name].count++;
            playHistory.playlists[playlist.name].lastPlayed = Date.now();

            // Update popular playlists
            updatePopularPlaylists();

            // Start playing the first song in the playlist
            currentSongIndex = playlist.songs[0].index;
            updateCurrentSong();
            if (isPlaying) {
                pauseMusic();
            }
            playMusic();
        }

        function playPlaylistFromSlider(playlistName) {
            // This function is for the hardcoded popular playlists in the Discover section.
            // Since we're removing mock data, these will not be dynamic initially.
            // You can remove the hardcoded popular playlists from the HTML if you want them to be purely dynamic.
            // For now, it will just play a random song if no real playlists are tracked.

            // Track playlist play
            if (!playHistory.playlists[playlistName]) {
                playHistory.playlists[playlistName] = { count: 0, lastPlayed: Date.now() };
            }
            playHistory.playlists[playlistName].count++;
            playHistory.playlists[playlistName].lastPlayed = Date.now();

            // Update popular playlists
            updatePopularPlaylists();

            // Play a random song for demo if there are songs, otherwise do nothing
            if (songs.length > 0) {
                currentSongIndex = Math.floor(Math.random() * songs.length);
                updateCurrentSong();
                if (isPlaying) {
                    pauseMusic();
                }
                playMusic();
            } else {
                alert('Adicione músicas para tocar playlists.');
            }
        }

        function updatePopularPlaylists() {
            const playlistsContainer = document.getElementById('popularPlaylistsContainer');
            const sortedPlaylists = Object.entries(playHistory.playlists)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 5);

            if (sortedPlaylists.length > 0) {
                playlistsContainer.innerHTML = sortedPlaylists.map(([playlistName, data], index) => {
                    // Find the actual playlist to get its cover
                    const actualPlaylist = playlists.find(p => p.name === playlistName);
                    const playlistCover = actualPlaylist && actualPlaylist.cover ?
                        actualPlaylist.cover :
                        "https://via.placeholder.com/200?text=Playlist+Cover"; // Generic placeholder

                    return `
                        <div class="swiper-slide">
                            <img src="${playlistCover}" alt="Playlist" class="slide-image">
                            <div class="slide-overlay">
                                <h3 class="slide-title">${playlistName}</h3>
                                <button class="play-button" onclick="playPlaylistFromSlider('${playlistName}')">
                                    <i class="fas fa-play"></i>
                                    Ouvir Agora
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                // If no popular playlists are tracked, display a message
                playlistsContainer.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhuma playlist popular ainda.</p>';
            }
        }

        function deletePlaylist(playlistId) {
            if (confirm('Tem certeza que deseja excluir esta playlist?')) {
                playlists = playlists.filter(p => p.id !== playlistId);
                savePlaylists();
                renderPlaylists();
            }
        }

        function savePlaylists() {
            localStorage.setItem('musicPlayer_playlists', JSON.stringify(playlists));
        }

        function loadPlaylists() {
            const saved = localStorage.getItem('musicPlayer_playlists');
            if (saved) {
                playlists = JSON.parse(saved);
            }
        }

        function loadSavedData() {
            loadSongCovers();
            loadLoadedAds(); // Load previously loaded ads
            renderLoadedAds(); // Render them
            // No need to load albums here, as loadAlbums() is called in initializeApp()
        }

        // Initialize Swiper
        function initializeSwiper() {
            // Destroy existing Swiper instance if any
            if (window.mySwiper) {
                window.mySwiper.destroy(true, true);
            }

            // Initialize Swiper only if there are slides to show, otherwise it might cause issues
            const popularPlaylistsContainer = document.getElementById('popularPlaylistsContainer');
            if (popularPlaylistsContainer && popularPlaylistsContainer.children.length > 0 && popularPlaylistsContainer.children[0].tagName === 'DIV') { // Check if there are actual slides, not just a message
                window.mySwiper = new Swiper(".swiper", {
                    effect: "coverflow",
                    grabCursor: true,
                    centeredSlides: true,
                    loop: true,
                    speed: 600,
                    slidesPerView: "auto",
                    coverflowEffect: {
                        rotate: 10,
                        stretch: 120,
                        depth: 200,
                        modifier: 1,
                        slideShadows: false,
                    },
                    pagination: {
                        el: ".swiper-pagination",
                        clickable: true
                    },
                    on: {
                        click(event) {
                            this.slideTo(this.clickedIndex);
                        },
                    }
                });
            } else {
                // If no slides, ensure Swiper container is empty or shows message
                if (popularPlaylistsContainer) {
                    popularPlaylistsContainer.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.7); grid-column: 1 / -1;">Nenhuma playlist popular ainda.</p>';
                }
            }
        }

        // Update song cover
        function updateSongCover(songIndex, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    songs[songIndex].cover = e.target.result;

                    // Update the song image in the UI
                    const songImg = input.parentElement.parentElement.querySelector('img');
                    songImg.src = e.target.result;

                    // Update the player cover if this is the current song
                    if (currentSongIndex === songIndex) {
                        document.getElementById('coverImage').src = e.target.result;
                        document.getElementById('floatingCoverImage').src = e.target.result;
                    }

                    // Save to localStorage
                    localStorage.setItem('musicPlayer_songs', JSON.stringify(songs));
                };
                reader.readAsDataURL(file);
            }
        }

        // Load custom song covers
        function loadSongCovers() {
            const saved = localStorage.getItem('musicPlayer_songs');
            if (saved) {
                songs = JSON.parse(saved);
            } else {
                songs = []; // Ensure songs array is empty if no saved data
            }
            // Ensure all songs have an artistCover property for consistency
            songs.forEach(song => {
                if (!song.artistCover) {
                    song.artistCover = getArtistImage(song.artist);
                }
            });
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase();
            const songItems = document.querySelectorAll('.song-item');

            songItems.forEach(item => {
                const title = item.querySelector('.song-title').textContent.toLowerCase();
                const artist = item.querySelector('.song-artist').textContent.toLowerCase();
                const albumElement = item.querySelector('.song-album');
                const album = albumElement ? albumElement.textContent.toLowerCase() : ''; // Check if element exists

                if (title.includes(searchTerm) || artist.includes(searchTerm) || album.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Playlist editing functions
        function editPlaylist(playlistId) {
            currentEditingPlaylist = playlistId;
            const playlist = playlists.find(p => p.id === playlistId);
            if (!playlist) return;

            document.getElementById('modalPlaylistName').textContent = `Editar: ${playlist.name}`;
            document.getElementById('playlistModal').style.display = 'block';

            renderAvailableSongs();
            renderPlaylistSongs(playlist);
        }

        function closePlaylistModal() {
            document.getElementById('playlistModal').style.display = 'none';
            currentEditingPlaylist = null;
        }

        function renderAvailableSongs() {
            const availableSongs = document.getElementById('availableSongs');
            const playlist = playlists.find(p => p.id === currentEditingPlaylist);

            if (songs.length === 0) {
                availableSongs.innerHTML = '<p style="text-align: center; opacity: 0.7;">Adicione músicas para vê-las aqui.</p>';
                return;
            }

            availableSongs.innerHTML = songs.map((song, index) => {
                const isInPlaylist = playlist.songs.some(s => s.index === index);
                return `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; margin-bottom: 5px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${song.cover}" alt="${song.title}" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover;">
                            <div>
                                <div style="font-size: 0.9rem; margin-bottom: 2px;">${song.title}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${song.artist} - ${song.album}</div>
                            </div>
                        </div>
                        <button onclick="addSongToPlaylist(${index})" ${isInPlaylist ? 'disabled' : ''} style="padding: 5px 10px; background: ${isInPlaylist ? 'rgba(100, 100, 100, 0.5)' : 'rgba(169, 150, 253, 0.6)'}; border: none; border-radius: 5px; color: white; cursor: ${isInPlaylist ? 'not-allowed' : 'pointer'}; font-size: 0.8rem; transition: all 0.3s ease;">
                            ${isInPlaylist ? 'Adicionada' : 'Adicionar'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        function renderPlaylistSongs(playlist) {
            const playlistSongs = document.getElementById('playlistSongs');

            if (playlist.songs.length === 0) {
                playlistSongs.innerHTML = '<p style="text-align: center; opacity: 0.7;">Nenhuma música na playlist.</p>';
                return;
            }

            playlistSongs.innerHTML = playlist.songs.map(playlistSong => {
                const song = songs[playlistSong.index];
                if (!song) return ''; // Handle case where song might have been deleted

                return `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; margin-bottom: 5px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${song.cover}" alt="${song.title}" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover;">
                            <div>
                                <div style="font-size: 0.9rem; margin-bottom: 2px;">${song.title}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${song.artist} - ${song.album}</div>
                            </div>
                        </div>
                        <button onclick="removeSongFromPlaylist(${playlistSong.index})" style="padding: 5px 10px; background: rgba(220, 53, 69, 0.6); border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 0.8rem; transition: all 0.3s ease;">
                            Remover
                        </button>
                    </div>
                `;
            }).join('');
        }

        function addSongToPlaylist(songIndex) {
            const playlist = playlists.find(p => p.id === currentEditingPlaylist);
            if (!playlist) return;

            const isAlreadyInPlaylist = playlist.songs.some(s => s.index === songIndex);
            if (isAlreadyInPlaylist) return;

            playlist.songs.push({
                index: songIndex,
                addedAt: new Date().toISOString()
            });

            savePlaylists();
            renderPlaylists();
            renderAvailableSongs();
            renderPlaylistSongs(playlist);
        }

        function removeSongFromPlaylist(songIndex) {
            const playlist = playlists.find(p => p.id === currentEditingPlaylist);
            if (!playlist) return;

            playlist.songs = playlist.songs.filter(s => s.index !== songIndex);

            savePlaylists();
            renderPlaylists();
            renderAvailableSongs();
            renderPlaylistSongs(playlist);
        }

        function changePlaylistCover(playlistId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const playlist = playlists.find(p => p.id === playlistId);
                        if (playlist) {
                            playlist.cover = event.target.result;
                            savePlaylists();
                            renderPlaylists();
                            updatePopularPlaylists(); // Update popular playlists to reflect new cover
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // New function for floating controls hover effect
        function setupFloatingControlsHover() {
            const floatingControls = document.getElementById('floatingControls');
            let showTimeout; // Usado para atrasar o reaparecimento

            // Função para esconder o player
            const hideControls = () => {
                // Só esconde se um modal não estiver aberto
                if (document.getElementById('playlistModal').style.display === 'none' && document.getElementById('mariaBonitaModal').style.display === 'none') {
                    floatingControls.classList.add('hidden');
                }
            };

            // Função para mostrar o player
            const showControls = () => {
                clearTimeout(showTimeout); // Limpa qualquer timeout de reaparecimento pendente
                floatingControls.classList.remove('hidden');
            };

            // Event listener para quando o mouse ENTRA na área do player flutuante
            floatingControls.addEventListener('mouseenter', hideControls); // Esconde imediatamente

            // Event listener para quando o mouse SAI da área do player flutuante
            floatingControls.addEventListener('mouseleave', () => {
                // Define um timeout para mostrar o player após um pequeno atraso
                showTimeout = setTimeout(showControls, 500); // 0.5 segundos de atraso para reaparecer
            });

            // O player começa visível por padrão (sem a classe 'hidden' no CSS)
            // Não precisamos de um timeout inicial para esconder, pois ele só esconde no mouseenter.
        }

        // Maria Bonita AI Functions
        function openMariaBonitaModal() {
            document.getElementById('mariaBonitaModal').style.display = 'flex';
            document.getElementById('mariaBonitaText').value = ''; // Clear previous text
            updateMariaBonitaCharCounter();
            document.getElementById('mariaBonitaStatus').textContent = ''; // Clear status message
        }

        function closeMariaBonitaModal() {
            document.getElementById('mariaBonitaModal').style.display = 'none';
        }

        function loadCharacterUsage() {
            const savedUsage = localStorage.getItem('mariaBonita_charsUsed');
            const savedDate = localStorage.getItem('mariaBonita_lastResetDate');

            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            if (savedDate) {
                const lastReset = new Date(savedDate);
                const lastResetMonth = lastReset.getMonth();
                const lastResetYear = lastReset.getFullYear();

                if (currentMonth !== lastResetMonth || currentYear !== lastResetYear) {
                    // New month, reset character count
                    charsUsedThisMonth = 0;
                    lastResetDate = today.toISOString();
                    saveCharacterUsage();
                } else {
                    charsUsedThisMonth = parseInt(savedUsage || '0');
                    lastResetDate = savedDate;
                }
            } else {
                // First time usage, initialize
                charsUsedThisMonth = 0;
                lastResetDate = today.toISOString();
                saveCharacterUsage();
            }
            updateMariaBonitaCharCounter();
        }

        function saveCharacterUsage() {
            localStorage.setItem('mariaBonita_charsUsed', charsUsedThisMonth.toString());
            localStorage.setItem('mariaBonita_lastResetDate', lastResetDate);
        }

        function updateMariaBonitaCharCounter() {
            const textarea = document.getElementById('mariaBonitaText');
            const currentCharsSpan = document.getElementById('currentChars');
            const maxCharsSpan = document.getElementById('maxChars');
            const charsUsedDisplay = document.getElementById('charsUsedDisplay');
            const nextResetDateDisplay = document.getElementById('nextResetDate');

            const currentTextLength = textarea.value.length;
            currentCharsSpan.textContent = currentTextLength;
            maxCharsSpan.textContent = MAX_CHARS_MONTHLY - charsUsedThisMonth;

            charsUsedDisplay.textContent = charsUsedThisMonth;

            const nextReset = new Date(lastResetDate);
            nextReset.setMonth(nextReset.getMonth() + 1);
            nextReset.setDate(1); // Reset to the first day of the next month
            nextResetDateDisplay.textContent = nextReset.toLocaleDateString('pt-BR');

            if (charsUsedThisMonth >= MAX_CHARS_MONTHLY) {
                textarea.disabled = true;
                document.querySelector('.maria-bonita-modal-content button').disabled = true;
                document.getElementById('mariaBonitaStatus').textContent = 'Limite de caracteres mensal atingido. Redefinirá no próximo mês.';
                document.getElementById('mariaBonitaStatus').className = 'maria-bonita-status error';
            } else {
                textarea.disabled = false;
                document.querySelector('.maria-bonita-modal-content button').disabled = false;
                document.getElementById('mariaBonitaStatus').textContent = '';
                document.getElementById('mariaBonitaStatus').className = 'maria-bonita-status';
            }
        }

        document.getElementById('mariaBonitaText').addEventListener('input', function () {
            const text = this.value;
            const remainingMonthlyChars = MAX_CHARS_MONTHLY - charsUsedThisMonth;

            if (text.length > remainingMonthlyChars) {
                this.value = text.substring(0, remainingMonthlyChars);
                document.getElementById('mariaBonitaStatus').textContent = 'Você atingiu o limite de caracteres disponível para este mês.';
                document.getElementById('mariaBonitaStatus').className = 'maria-bonita-status error';
            } else {
                document.getElementById('mariaBonitaStatus').textContent = '';
                document.getElementById('mariaBonitaStatus').className = 'maria-bonita-status';
            }
            updateMariaBonitaCharCounter();
        });

        function resetCharacterCount() {
            if (confirm('Tem certeza que deseja redefinir a contagem de caracteres? Isso é apenas para teste e não afeta o limite real da API.')) {
                charsUsedThisMonth = 0;
                lastResetDate = new Date().toISOString();
                saveCharacterUsage();
                updateMariaBonitaCharCounter();
                alert('Contagem de caracteres redefinida para 0.');
            }
        }

        async function speakMariaBonita() {
            const text = document.getElementById('mariaBonitaText').value.trim();
            const statusElement = document.getElementById('mariaBonitaStatus');

            if (!text) {
                statusElement.textContent = 'Por favor, digite o texto que a Maria Bonita deve falar.';
                statusElement.className = 'maria-bonita-status error';
                return;
            }

            if (charsUsedThisMonth + text.length > MAX_CHARS_MONTHLY) {
                statusElement.textContent = 'Texto muito longo. Você excederia o limite de caracteres mensal.';
                statusElement.className = 'maria-bonita-status error';
                return;
            }

            statusElement.textContent = 'Gerando áudio...';
            statusElement.className = 'maria-bonita-status';

            try {
                // Pause current music and lower its volume
                if (currentAudio && !currentAudio.paused) {
                    originalVolume = currentAudio.volume; // Save current volume
                    let currentVolume = originalVolume;
                    const fadeOutInterval = setInterval(() => {
                        currentVolume = Math.max(0, currentVolume - 0.05); // Decrease by 0.05
                        currentAudio.volume = currentVolume;
                        if (currentVolume <= 0) {
                            clearInterval(fadeOutInterval);
                            currentAudio.pause();
                            proceedWithMariaBonitaSpeech();
                        }
                    }, 50); // Adjust fade out speed
                } else {
                    proceedWithMariaBonitaSpeech();
                }

                async function proceedWithMariaBonitaSpeech() {
                    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${ELEVEN_LABS_VOICE_ID}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'xi-api-key': ELEVEN_LABS_API_KEY
                        },
                        body: JSON.stringify({
                            text: text,
                            model_id: "eleven_multilingual_v2", // Use a multilingual model for Portuguese
                            voice_settings: {
                                stability: 0.75,
                                similarity_boost: 0.75
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`Eleven Labs API error: ${response.status} - ${errorData.detail || response.statusText}`);
                    }

                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);

                    const mariaBonitaAudio = new Audio(audioUrl);
                    mariaBonitaAudio.play();

                    charsUsedThisMonth += text.length;
                    saveCharacterUsage();
                    updateMariaBonitaCharCounter();

                    statusElement.textContent = 'Anúncio reproduzido com sucesso!';
                    statusElement.className = 'maria-bonita-status success';

                    mariaBonitaAudio.onended = () => {
                        // Restore original music volume gradually
                        if (currentAudio && originalVolume > 0) {
                            currentAudio.volume = 0; // Start from 0
                            let currentVolume = 0;
                            const fadeInInterval = setInterval(() => {
                                currentVolume = Math.min(originalVolume, currentVolume + 0.05); // Increase by 0.05
                                currentAudio.volume = currentVolume;
                                if (currentVolume >= originalVolume) {
                                    clearInterval(fadeInInterval);
                                }
                            }, 50); // Adjust fade in speed
                            currentAudio.play(); // Resume original music
                        }
                        URL.revokeObjectURL(audioUrl); // Clean up the object URL
                        statusElement.textContent = ''; // Clear status after playback
                        statusElement.className = 'maria-bonita-status';
                    };
                }

            } catch (error) {
                console.error('Erro ao gerar áudio da Maria Bonita:', error);
                statusElement.textContent = `Erro: ${error.message}. Verifique sua chave API ou o limite de caracteres.`;
                statusElement.className = 'maria-bonita-status error';
                // Restore original music volume in case of error
                if (currentAudio) {
                    currentAudio.volume = originalVolume;
                    currentAudio.play(); // Try to resume original music
                }
            }
        }
    </script>
</body>

</html>